\section{Related work}
The problem of detecting malicious macros inside Office documents has determined the creation of multiple analysis tools meant to help researchers and, in recent years, multiple studies were conducted to test new methods of detecting malicious files. The main focus of these methods are the structural properties of the macro code which derive from obfuscation or features that try to describe general aspects of the code and behavioral features. 
\par
In addition to having analysis capabilities, the mentioned tools are also aimed at detecting malicious traits inside Office files. OfficeMalScanner\footnote{http://www.reconstructer.org/about.html} is a free forensic tool that can be used to scan for malicious traces such as shellcode heuristics, PE-files\footnote{Portable Executable files. The Portable Executable (PE) format is a file format which defines the structure of executables, Dynamic-Link Libraries (DLLs) and other files used by the Windows operating system.}  or embedded OLE streams in legacy files which use the old OLE binary format. Another tool aimed at detecting vulnerabilities is OfficeCAT\footnote{https://www.aldeid.com/wiki/Officecat} which is an Office file checker based on searching specific signatures to determine if a legacy file is unsafe. Microsoft OffVis\footnote{https://www.aldeid.com/wiki/OffVis} is a tool that helps with the visualisation and understanding of Office files in OLE format (.doc, .xls, .ppt) and can also identify exploits by checking vulnerability signatures. pyOLEScanner\footnote{https://www.aldeid.com/wiki/PyOLEScanner} is a Python script inspired by OfficeMalScanner which has the ability to scan and evaluate a file in order to determine if it could be malicious.
\par
A machine learning approach to malicious macro detection was presented by Sangwoo Kim et al.\cite{KimHOL18} It is based on 15 discriminant static features that describe certain obfuscation techniques used in the code. These features are associated with four types of obfuscation methods: random obfuscation, split obfuscation, encoding obfuscation and logic obfuscation. The training was performed on a set of 2,537 files (773 benign, 1,764 malicious) and five classifiers were tested: SVM (95,5\%), Random Forest (96,5\%), Multi-Layer Perceptron (97\%), Linear Discriminant Analysis (90,1\%) and Bernoulli Naive Bayes (89,1\%). 
\par
A similar approach to macro detection is described by Ed Aboud and Darragh O'Brien\cite{AboudO18}. They are using features based on the macro found inside Office files which can describe more generic properties of the VBA code, such as Macro Keywords, Count of Integer Variables, etc. Additionally, an OCR library is used to identify certain phrases used in social engineering attacks such as Enable Content and Previous Version. The images containing these phrases are extracted by searching image magic numbers in the OLE binary. Using the extracted characteristics, they created a feature vector which was the input for five different classifiers. The training was performed on a set of 400 samples (200 benign, 200 malicious) and the testing phase consisted of 528 malicious samples and 83 benign samples. The performance of these classifiers was evaluated in terms of the TPR (True Positives Rate): Random Forest (98,9875\%), KNeighbors (97,527\%), DecisionTree (98,225\%), GaussianNB (97,02\%).
\par
In "Macro Malware Detection using Machine Learning Techniques"\cite{SantosT17}, Sergio De los Santos and Jose Torres propose the idea of using the features extracted by the python libraries OleFile and OleVBA. They establish a feature vector composed of 45 properties, but they highlight the fact that they are not distinct, some being obtained by discretizing features that are not boolean in nature. Their system was trained  using the following classifiers with the following accuracy values during the test phase: SVM (89\%),  Decision Tree (95\%), Random Forest (94\%) and Neural Networks (99\%). 
\par
ALDOCX is a framework implemented by Nisam et al.\cite{NissimCE17} based on machine learning classifiers, which uses features related to the structure of the paths in a ZIP archive, a methodology named SFEM. The extracted properties serve as input for an SVM classifier paired with an Active Learning component, which allows the system to continuously update the detection model. The classifier was trained on a set of 16,811 samples (327 malicious, 16,484 benign) and achieved a TPR of 93.34\%, FPR (False Positives Rate) of 0.19\% and 99.67\% accuracy. It is important to point out that, due to the process of choosing the features (they are paths inside a zip file), this framework only supports the newer OOXML file format (.docx, .xlsx) of Office files.
\par
Although not a detection method itself, Microsoft\footnote{https://www.microsoft.com/security/blog/2018/09/12/office-vba-amsi-parting-the-veil-on-malicious-macros/} implemented back in 2015 the Antimalware Scan Interface (AMSI) which allows applications on Windows 10 to request a scan of the memory buffer by an AV solution\footnote{Antivirus solution - software used on a system for the detection and removal of malicious programs} This allows the logging of macro behaviour at runtime, which can be used to analyze macro code in its deobfuscated state.
\par
As we can observe from the research work and tools mentioned above, most of the detection techniques are based around obfuscation, dynamic analysis, static, signature-based evaluation or a rather low number of features extracted from the macro code inside the VBA project found in Office files.
In the following sections, we will present our solution regarding the detection of malicious macro code using features which can describe the sample space in a more generic manner.