\section{Problem description}

The key points of the Visual Basic Application based malicious software are the accessibility and the popularity of the Office Products. This is ensured both due to the fact that the Visual Basic Application language grants access to the majority of the functions implemented in Windows API and to the mass usage of the Office Products, both in business and non-business fields. According to a statistic made by Spiceworks\footnote{https://community.spiceworks.com/software/articles/2873-data-snapshot-the-state-of-productivity-suites-in-the-workplace} nearly 82\% of companies use Microsoft Office. Knowing that, it is easier for an attacker to build a malicious program which will be granted to run, with a certain probability, on the target machine. However, over the past years, Microsoft implemented different security patches which fixed known vulnerabilities, nowadays the execution of a macro without user content being denied. Therefore, the attackers had to implement social engineering methods to trick an user into executing the malicious macro.
\par
Malicious macros are used both as a delivery method and as a standalone malicious entity. If in the past the main target of a malicious document was to spread across the network, nowadays, the potential offered by those products made the malware creators to rethink their usage. It is more common to see a document which is targeting stealing sensitive information from companies or to deliver a destructive component, for example, a ransomware. According to CISCO\footnote{https://www.cisco.com/c/dam/m/digital/elq-cmcglobal/witb/acr2018/acr2018final.pdf} more than 38\% of malicious files extensions found in 2017 in groups of most prevalent files were Microsoft Office formats.
\par
Considering the above observation, we developed a solution to detect the malicious macros inside an office file and to keep the rate of false positives as low as possible, all with respect to performance requirments. Our system is based on a derived version of perceptron, OSC\cite{OSC}, and it is used over a set of features extracted from the binary visual basic application which is found inside an office document. The sistem extracts the macros within a file, tokenize them, extracts the sequence of features and feeds them to the machine learning algorithm. In this way, we provide a complete system to detect if an office file is indeed malicious or not.
\par
Moreover, taking into account that the OSC is keeping the rate of false positive for its models at a small percentage, we can easily use and integrate them in Bitdefender's technologies.
